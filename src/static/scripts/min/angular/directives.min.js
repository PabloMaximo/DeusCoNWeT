var picbit=angular.module("picbit");picbit.directive("ngDrag",function(){"use strict";function a(a,b,c){a.move={},b.css({position:"absolute"});for(var d in c.$attr)c.hasOwnProperty(d)&&c.$observe(d,function(){});a.dragging=function(c){if("true"===b.attr("draggable")){var d,e,f;0!==c.clientX&&0!==c.clientY&&(a.move.x=a.move.x||c.clientX-c.target.offsetLeft,a.move.y=a.move.y||c.clientY-c.target.offsetTop,d=c.clientX-c.target.offsetLeft-a.move.x,e=c.clientY-c.target.offsetTop-a.move.y,f=a.calculatePosition(c.target,d,e),c.target.style.top=f.top+"px",c.target.style.left=f.left+"px")}},a.calculatePosition=function(a,b,c){var d={},e={},f={};d.left=a.offsetLeft+b,d.right=a.offsetLeft+b+a.offsetWidth,d.top=a.offsetTop+c,d.bottom=a.offsetTop+c+a.offsetHeight;var g=document.querySelector("#container");return e.top=parseInt(angular.element(g).css("padding-top").split("px")[0])||0,e.right=parseInt(angular.element(g).css("padding-right").split("px")[0])||0,e.bottom=parseInt(angular.element(g).css("padding-bottom").split("px")[0])||0,e.left=parseInt(angular.element(g).css("padding-left").split("px")[0])||0,f.left=g.offsetLeft+e.left<d.left,f.right=g.offsetWidth+g.offsetLeft-e.right>d.right,f.top=g.offsetTop+e.top<d.top,f.bottom=g.offsetHeight+g.offsetTop-e.bottom>d.bottom,d.top=f.top?d.top:g.offsetTop+e.top,d.top=f.bottom?d.top:g.offsetTop+g.offsetHeight-a.offsetHeight-e.bottom,d.left=f.left?d.left:g.offsetLeft+e.left,d.left=f.right?d.left:g.offsetLeft+g.offsetWidth-a.offsetWidth-e.right,d},a.deleteShadow=function(a){var b=document.createElement("img");b.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.dataTransfer.setDragImage(b,20,20)},a.deleteMove=function(){a.move={}},b.on("drag",a.dragging),b.on("dragstart",a.deleteShadow),b.on("dragend",a.deleteMove)}return{link:a,scope:!0}}),picbit.directive("ngContainer",function(){"use strict";function a(a,b){a.dropObject=function(a){a.preventDefault(),a.stopPropagation();var c,d,e,f,g,h;if(c=a.dataTransfer.getData("element"),c&&0===document.getElementsByTagName(c).length){if(e=angular.element("<"+c+"/>"),e.attr("ng-drag",""),d=a.dataTransfer.getData("attributes")){d=JSON.parse(d);for(h in d)d.hasOwnProperty(h)&&e.attr(h,d[h])}e.attr("draggable","{{modifySelected === '"+c+"'}}"),b.append(e),b.scope().listComponentAdded.push(c),f=b.injector(),g=f.get("$compile"),g(e)(e.scope());var i=e.scope().calculatePosition(e[0],a.clientX-e[0].offsetLeft,a.clientY-e[0].offsetTop);e.css({position:"absolute",top:i.top+"px",left:i.left+"px"})}},a.dragEntry=function(a){a.preventDefault()},b.on("drop",a.dropObject),b.on("dragover",a.dragEntry)}return{link:a}}),picbit.directive("ngCreateElement",function(){"use strict";function a(a,b){a.comienzo=function(b){b.dataTransfer.setData("element",a.idElement),a.attributes&&b.dataTransfer.setData("attributes",a.attributes);var c;c=document.createElement("img"),c.src=a.imagesrc||"",b.dataTransfer.setDragImage(c,0,0)},b.attr("draggable","true"),b.on("dragstart",a.comienzo)}return{scope:{imagesrc:"@imagesrc",attributes:"@listAttributes",idElement:"@idElement"},link:a}});
